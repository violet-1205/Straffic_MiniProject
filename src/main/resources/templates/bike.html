<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">
<body>
<div layout:fragment="content">
    <style>
        .bike-container { max-width: 1100px; margin: 0 auto; padding: 20px; }
        .content-wrapper { display: flex; gap: 20px; }
        .left-panel { width: 360px; border-right: 1px solid #eee; padding-right: 20px; }
        .filter-section { border: 1px solid #eee; border-radius: 12px; padding: 16px; }
        .filter-option { display:flex; align-items:center; gap:8px; padding:8px; cursor:pointer; border-radius:8px; }
        .filter-option.active { background:#f8f9fa; }
        .search-card { margin-top:16px; border:1px solid #eee; border-radius:12px; padding:16px; }
        .search-button { background:#0066ff; color:#fff; padding:10px 14px; border:none; border-radius:8px; cursor:pointer; }
        .right-panel { flex:1; }
        #map { width: 100%; height: 500px; border-radius: 12px; border: 2px solid #e9ecef; }
        .custom-infowindow { padding: 15px; min-width: 200px; }
        .info-status { display:inline-block; padding:4px 10px; background:#28a745; color:#fff; border-radius:12px; font-size:.8rem; font-weight:600; }
        .info-status.low { background:#ffc107; } .info-status.none { background:#dc3545; }
    </style>

    <div class="bike-container">
        <h1>ğŸš´ ê³µìœ  ëª¨ë¹Œë¦¬í‹°</h1>
        <p>ë”°ë¦‰ì´ì™€ í‚¥ë³´ë“œë¥¼ ì§€ë„ì—ì„œ í™•ì¸í•˜ê³  ê°€ê¹Œìš´ ìœ„ì¹˜ë¥¼ ì°¾ì•„ë³´ì„¸ìš”</p>

        <div class="content-wrapper">
            <div class="left-panel">
                <div class="filter-section">
                    <div style="font-weight:700; margin-bottom:8px;">ğŸ” ëª¨ë¹Œë¦¬í‹° íƒ€ì… ì„ íƒ</div>
                    <div class="filter-option active" onclick="toggleFilter('bike', this)">
                        <input type="checkbox" id="filter-bike" checked>
                        <label for="filter-bike">ğŸš´ ë”°ë¦‰ì´ (ê³µê³µìì „ê±°)</label>
                    </div>
                    <div class="filter-option active" onclick="toggleFilter('kickboard', this)">
                        <input type="checkbox" id="filter-kickboard" checked>
                        <label for="filter-kickboard">ğŸ›´ í‚¥ë³´ë“œ (ì „ë™ìŠ¤ì¿ í„°)</label>
                    </div>
                </div>

                <div class="search-card">
                    <div class="search-title">ë‚´ ìœ„ì¹˜ ê¸°ë°˜ ê²€ìƒ‰</div>
                    <button class="search-button" onclick="searchNearby()">ğŸ“ ë‚´ ìœ„ì¹˜ì—ì„œ ì°¾ê¸°</button>
                </div>
            </div>

            <div class="right-panel">
                <div id="map"></div>
            </div>
        </div>
    </div>

    <script th:src="'//dapi.kakao.com/v2/maps/sdk.js?appkey=' + ${kakaoKey} + '&autoload=false'"></script>
    <script>
        var map;
        var markers = { bike: [], kickboard: [] };
        window.addEventListener('load', function() {
            kakao.maps.load(function() {
                var container = document.getElementById('map');
                var options = { center: new kakao.maps.LatLng(37.4895, 126.7234), level: 5 };
                map = new kakao.maps.Map(container, options);
                var bikeStations = [
                    {name:'ë¶€í‰ì—­ 1ë²ˆ ì¶œêµ¬', lat:37.4895, lng:126.7234, available:12, type:'bike'},
                    {name:'ë¶€í‰ì—­ 3ë²ˆ ì¶œêµ¬', lat:37.4900, lng:126.7240, available:8, type:'bike'},
                    {name:'ë¶€í‰ì‹œì¥ì—­', lat:37.4920, lng:126.7210, available:3, type:'bike'}
                ];
                var kickboardLocations = [
                    {name:'í‚¥ë³´ë“œ #KK-001', lat:37.4890, lng:126.7230, battery:100, available:true, type:'kickboard'},
                    {name:'í‚¥ë³´ë“œ #KK-002', lat:37.4897, lng:126.7237, battery:95, available:true, type:'kickboard'},
                    {name:'í‚¥ë³´ë“œ #KK-003', lat:37.4903, lng:126.7225, battery:90, available:true, type:'kickboard'},
                    {name:'í‚¥ë³´ë“œ #KK-004', lat:37.4910, lng:126.7245, battery:85, available:false, type:'kickboard'}
                ];
                bikeStations.forEach(function(station) { createMarker(station, 'bike'); });
                kickboardLocations.forEach(function(location) { createMarker(location, 'kickboard'); });
            });
        });
        function createMarker(data, type) {
            var position = new kakao.maps.LatLng(data.lat, data.lng);
            var imageSrc = type === 'bike' ? 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png' : 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_red.png';
            var imageSize = new kakao.maps.Size(24, 35);
            var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);
            var marker = new kakao.maps.Marker({ position: position, image: markerImage, title: data.name });
            marker.setMap(map);
            markers[type].push(marker);
            var content = '<div class="custom-infowindow">';
            if (type === 'bike') {
                var statusClass = data.available > 5 ? '' : (data.available > 0 ? 'low' : 'none');
                content += '<div style="font-weight:700; margin-bottom:8px;">' + data.name + '</div>';
                content += '<div>ğŸš´ ëŒ€ì—¬ ê°€ëŠ¥: <span class="info-status ' + statusClass + '">' + data.available + 'ëŒ€</span></div>';
            } else {
                var statusClass = data.available ? '' : 'none';
                var statusText = data.available ? 'ì´ìš© ê°€ëŠ¥' : 'ì´ìš© ì¤‘';
                content += '<div style="font-weight:700; margin-bottom:8px;">' + data.name + '</div>';
                content += '<div>ğŸ”‹ ë°°í„°ë¦¬: <strong>' + data.battery + '%</strong></div>';
                content += '<div>ìƒíƒœ: <span class="info-status ' + statusClass + '">' + statusText + '</span></div>';
            }
            content += '</div>';
            var infowindow = new kakao.maps.InfoWindow({ content: content, removable: true });
            kakao.maps.event.addListener(marker, 'click', function() { infowindow.open(map, marker); });
        }
        function toggleFilter(type, element) {
            var checkbox = element.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;
            if (checkbox.checked) {
                element.classList.add('active');
                markers[type].forEach(function(m) { m.setMap(map); });
            } else {
                element.classList.remove('active');
                markers[type].forEach(function(m) { m.setMap(null); });
            }
        }
        function searchNearby() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(pos) {
                    var moveLatLon = new kakao.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
                    map.setCenter(moveLatLon); map.setLevel(4);
                    alert('í˜„ì¬ ìœ„ì¹˜ë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤');
                }, function() { alert('ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'); });
            } else { alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤'); }
        }
    </script>
</div>
</body>
</html>
