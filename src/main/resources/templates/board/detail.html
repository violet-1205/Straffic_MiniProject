<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">

<th:block layout:fragment="css">
    <link rel="stylesheet" th:href="@{/css/board-detail.css(v=${#dates.createNow().getTime()})}">
</th:block>

<body>
<div layout:fragment="content">
    <div class="noticeView">
        <h3 th:text="${board.title}">ì œëª©</h3>
        <div class="noticeInfo">
            <dl>
                <dt>ì‘ì„±ì</dt>
                <dd th:text="${board.author != null ? board.author.name : 'ì•Œìˆ˜ì—†ìŒ'}">ì‘ì„±ì</dd>
            </dl>
            <dl>
                <dt>ë“±ë¡ì¼</dt>
                <dd th:text="${#temporals.format(board.createdAt, 'yyyy-MM-dd HH:mm')}">2025-01-01</dd>
            </dl>
            <dl>
                <dt>ì¡°íšŒìˆ˜</dt>
                <dd th:text="${board.views}">0</dd>
            </dl>
        </div>
        
        <div class="noticeCnts" th:utext="${board.content}">ë‚´ìš©</div>
        
        <div class="notice-images" th:if="${board.imageData != null}">
            <img th:src="@{/board/image/{id}(id=${board.id})}" alt="ì´ë¯¸ì§€">
        </div>

        <div class="comments-section">
            <div class="comments-header">
                <span class="material-symbols-outlined">forum</span>
                ëŒ“ê¸€ <span th:text="${board.comments != null ? board.comments.size() : 0}" style="color:#e53935;">0</span>
            </div>

            <div th:each="c : ${commentsSorted}" class="comment-item" th:classappend="${c.pinned} ? ' pinned'">
                <div class="comment-meta">
                    <div>
                        <span class="comment-author" th:text="${c.author != null ? c.author.name : 'ì•Œìˆ˜ì—†ìŒ'}">ì‘ì„±ì</span>
                        <span class="comment-date" th:text="${#temporals.format(c.createdAt, 'yyyy-MM-dd HH:mm')}">2025-01-01</span>
                    </div>
                    <div class="comment-actions">
                        <form th:if="${isAdmin and !c.pinned}"
                              th:action="@{/board/comment/{commentId}/pin(commentId=${c.id})}"
                              method="post" style="display:inline;">
                            <button class="comment-btn" type="submit">ìƒë‹¨ ê³ ì •</button>
                        </form>
                        <form th:if="${isAdmin and c.pinned}"
                              th:action="@{/board/comment/{commentId}/unpin(commentId=${c.id})}"
                              method="post" style="display:inline;">
                            <button class="comment-btn" type="submit">ê³ ì • í•´ì œ</button>
                        </form>
                        <form th:action="@{/board/comment/{commentId}/delete(commentId=${c.id})}" method="post" style="display:inline;" th:if="${isAdmin or (authName != null and c.author != null and c.author.id == authName)}">
                            <button class="comment-btn delete" type="submit" onclick="return confirm('ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ì‚­ì œ</button>
                        </form>
                    </div>
                </div>
                <div class="comment-content" th:utext="${c.content}">ëŒ“ê¸€ ë‚´ìš©</div>
            </div>

            <div sec:authorize="isAuthenticated()" class="comment-form">
                <div class="emoji-picker">
                    <button type="button" onclick="addEmoji('ğŸ˜€')">ğŸ˜€</button>
                    <button type="button" onclick="addEmoji('ğŸ‰')">ğŸ‰</button>
                    <button type="button" onclick="addEmoji('ğŸ‘')">ğŸ‘</button>
                    <button type="button" onclick="addEmoji('â¤ï¸')">â¤ï¸</button>
                    <button type="button" onclick="addEmoji('ğŸ˜‚')">ğŸ˜‚</button>
                </div>
                <form th:action="@{/board/{boardId}/comment(boardId=${board.id})}" method="post">
                    <div class="comment-input-group">
                        <textarea id="commentContent" name="content" placeholder="ë”°ëœ»í•œ ëŒ“ê¸€ì„ ë‚¨ê²¨ì£¼ì„¸ìš”." required></textarea>
                        <button class="btn-submit-comment" type="submit">ë“±ë¡</button>
                    </div>
                </form>
            </div>
            <div sec:authorize="!isAuthenticated()" style="text-align:center; padding: 20px; color:#999; font-size:0.9rem;">
                ë¡œê·¸ì¸ í›„ ëŒ“ê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </div>
        </div>

        <div class="noticeBt">
            <a class="btList" th:href="@{/board/list}">ëª©ë¡</a>
            <div>
                <a class="btEdit" th:href="@{/board/edit/{id}(id=${board.id})}" th:if="${isAuthor}">ìˆ˜ì •</a>
                <form th:action="@{/board/delete/{id}(id=${board.id})}" method="post" style="display:inline;" th:if="${isAuthor or isAdmin}">
                    <button class="btDelete" type="submit" onclick="return confirm('ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ì‚­ì œ</button>
                </form>
            </div>
        </div>

        <div class="post-nav">
            <div class="post-nav-item">
                <span class="post-nav-label">ì´ì „ ê¸€</span>
                <a th:if="${previousPost != null}"
                   th:href="@{/board/view/{id}(id=${previousPost.id})}"
                   th:text="${previousPost.title}">ì´ì „ ê¸€ ì œëª©</a>
                <span class="post-nav-empty" th:if="${previousPost == null}">ì´ì „ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</span>
            </div>
            <div class="post-nav-item">
                <span class="post-nav-label">ë‹¤ìŒ ê¸€</span>
                <a th:if="${nextPost != null}"
                   th:href="@{/board/view/{id}(id=${nextPost.id})}"
                   th:text="${nextPost.title}">ë‹¤ìŒ ê¸€ ì œëª©</a>
                <span class="post-nav-empty" th:if="${nextPost == null}">ë‹¤ìŒ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</span>
            </div>
        </div>
    </div>
    <script>
        function addEmoji(e) {
            var ta = document.getElementById('commentContent');
            if (!ta) return;
            var start = ta.selectionStart || ta.value.length;
            var end = ta.selectionEnd || ta.value.length;
            ta.value = ta.value.substring(0, start) + e + ta.value.substring(end);
            ta.focus();
            ta.selectionStart = ta.selectionEnd = start + e.length;
        }
    </script>
</div>
</body>
</html>
